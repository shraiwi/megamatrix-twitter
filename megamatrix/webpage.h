#include <Arduino.h>
#define WEBPAGE F("<!DOCTYPE html><html><head> <style>*{transition-duration: 300ms; font-family: Arial;}#uploadfile{display: none;}.shadow{box-shadow: 0 0 8vw rgba(0, 0, 0, 0.3);}#pic{width: 100%; height: 100%; transform: scale(1);}#piccontainer{cursor: pointer; overflow: hidden; position: absolute; text-align: center; top: 0; bottom: 0; left: 0; right: 0; margin: auto; width: min(70vw, 70vh); height: min(70vw, 70vh); box-shadow: 0 0 2vw rgba(0, 0, 0, 0.2); border-radius: 1vw; image-rendering: optimizeSpeed; image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;}#piccontainer:hover{box-shadow: 0 0 4vw rgba(0, 0, 0, 0.5); width: min(80vw, 80vh); height: min(80vw, 80vh);}#piccontainer:active{box-shadow: 0 0 2vw rgba(0, 0, 0, 0.2); width: min(70vw, 70vh); height: min(70vw, 70vh);}#piccontainer:hover #pic{filter: brightness(75%); transform: scale(1.2);}#piccontainer:hover #send{opacity: 100%;}#piccontainer:active #pic{transform: scale(1.1);}#piccontainer:active #send{transform: translate(-50%, -120%) scale(0.9);}#piccontainer:hover #prompt{transform: translate(-50%, -100%) scale(1.1);}#prompt{z-index: 0; font-weight: bolder; font-size: 3em; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -100%); -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}#send{z-index: 2; color: white; font-weight: bolder; font-size: 3em; opacity: 0%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -120%); -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}</style></head><body> <div id=\"piccontainer\" ondragover=\"event.preventDefault()\" ondragenter=\"event.preventDefault()\" ondrop=\"handleDrop(event)\"> <p id=\"prompt\"><b>drag files here</b></p><p id=\"send\"><b>send</b></p><canvas id=\"pic\" onclick=\"upload()\"></canvas> </div><input id=\"uploadfile\" type=\"file\" onchange=\"handleDrop\"><br><script>let uploadButton=document.getElementById(\"upload\"); let canvas=document.getElementById(\"pic\"); let send=document.getElementById(\"piccontainer\"); let ctx=canvas.getContext(\"2d\"); let file=document.getElementById(\"uploadfile\"); ctx.imageSmoothingEnabled=false; ctx.fillStyle=\"black\"; let settings={square: 64, url: \"/img\",}; let imgData; function handleDrop(e){file.files=e.dataTransfer.files; handleFile.call(file); e.preventDefault();}send.ondrop=handleDrop; function handleFile(){if (this.files && this.files[0]){let img=document.createElement(\"IMG\"); img.src=URL.createObjectURL(this.files[0]); img.onload=function (){ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.drawImage(this, 0, 0, settings.square, settings.square); imgData=ctx.getImageData(0, 0, canvas.width, canvas.height).data.filter((_, i)=> (i + 1) % 4); console.log(imgData.reduce((a, b)=> a+b));}}}; file.addEventListener(\"change\", handleFile, true); canvas.width=canvas.height=settings.square; function download(){let file=new Blob([imgData],{type: \"application/octet-stream\",}); let a=document.createElement(\"a\"), urlData=URL.createObjectURL(file); a.href=urlData; a.download=\"image.bin\"; document.body.appendChild(a); a.click(); setTimeout(function(){document.body.removeChild(a); window.URL.revokeObjectURL(urlData);}, 0);}function upload(){fetch(settings.url,{method: \"POST\", headers:{\"Content-Type\": \"application/octet-stream\",}, body: imgData,}); /*let req=new XMLHttpRequest(); req.open(\"POST\", settings.url, true); req.onload=function (e){console.log(\"uploaded.\");}let b64dat=btoa(String.fromCharCode(...imgData)); req.send(b64dat);*/ console.log(imgData);}</script></body></html>")
